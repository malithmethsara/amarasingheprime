<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free & accurate Sri Lanka vehicle tax calculator 2025 by Amarasinghe Prime Enterprises — qualified vehicle importers from Japan. Instantly estimate customs, excise, VAT, and surcharge for any car, hybrid, or EV. Try our trusted tool now!">
    <meta name="keywords" content="Sri Lanka vehicle tax calculator, vehicle import taxes 2025, Japanese car import Sri Lanka, petrol car tax, diesel car tax, hybrid car tax, electric vehicle tax, Amarasinghe Prime Enterprises">
    <meta name="author" content="Amarasinghe Prime Enterprises">
    <meta name="robots" content="index, follow">
    <meta name="google-site-verification" content="8w8943-d9d83m2s">
    <title>Vehicle Tax Calculator Sri Lanka 2025 | Amarasinghe Prime Enterprises</title>
    
    <meta property="og:title" content="Sri Lanka Vehicle Tax Calculator 2025 by Amarasinghe Prime Enterprises">
    <meta property="og:description" content="Accurately calculate import taxes for Japanese vehicles in Sri Lanka with our 2025 tax calculator for petrol, diesel, hybrid, and electric cars.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://amarasingheprime.lk">
    <meta property="og:image" content="https://amarasingheprime.lk/social-share-image.jpg">
    <meta property="og:image:alt" content="Sri Lanka Vehicle Tax Calculator Interface">
    <meta property="og:site_name" content="Amarasinghe Prime Enterprises">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Sri Lanka Vehicle Tax Calculator 2025 by Amarasinghe Prime Enterprises">
    <meta name="twitter:description" content="Accurately calculate import taxes for Japanese vehicles in Sri Lanka with our 2025 tax calculator for petrol, diesel, hybrid, and electric cars.">
    <meta name="twitter:image" content="https://amarasingheprime.lk/social-share-image.jpg">

    <link rel="canonical" href="https://amarasingheprime.lk">
    <link rel="icon" href="https://amarasingheprime.lk/favicon.ico" sizes="48x48">
    <link rel="icon" type="image/png" sizes="32x32" href="https://amarasingheprime.lk/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://amarasingheprime.lk/apple-touch-icon.png">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" as="style" onload="this.rel='stylesheet'">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" as="style" onload="this.rel='stylesheet'">
    <link rel="preload" href="/logo.png" as="image">
    <style>
        :root {
            --primary: #003087;
            --primary-hover: #002060;
            --primary-light: #e3edfb;
            --bg1: #f7f9fc;
            --bg2: #e9eff6;
            --text: #2b2b2b;
            --muted: #5b5b5b;
            --card: #fff;
            --accent1: #e6f7ec;
            --accent2: #f4f4f4;
            --border1: #b6d2f7;
            --border2: #b9eac7;
            --banner-blue: #e6f0fa;
            --error: #d32f2f;
        }
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(90deg, var(--bg1), var(--bg2));
            color: var(--text);
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1rem 2.5rem;
            line-height: 1.5;
            overflow-x: hidden;
        }
        header {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.375rem;
            align-items: center;
            justify-items: center;
            margin-bottom: 0.625rem;
        }
        header img {
            max-width: 160px;
            height: auto;
        }
        header h1 {
            font-weight: 700;
            font-size: clamp(1.8rem, 5vw, 2.4rem);
            color: var(--primary);
            text-align: center;
        }
        header .tagline {
            color: var(--muted);
            font-weight: 600;
            text-align: center;
            font-size: 1rem;
        }
        #timeDateTime {
            text-align: center;
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .contact {
            display: flex;
            flex-wrap: wrap;
            gap: 0.875rem;
            align-items: center;
            justify-content: center;
            margin: 0.625rem 0;
            font-weight: 600;
        }
        .contact a {
            text-decoration: none;
            font-size: 1rem;
            transition: transform 0.2s;
        }
        .contact a:hover {
            transform: scale(1.05);
        }
        .contact .chip {
            display: inline-flex;
            gap: 0.5rem;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border-radius: 999px;
            background: var(--card);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid rgb(220,230,246);
            transition: background 0.18s, border-color 0.18s, color 0.18s;
        }
        .contact .chip i {
            width: 1.125rem;
            text-align: center;
        }
        .phone-chip {
            background: var(--accent2);
            color: #222;
            border: 1px solid var(--border2);
        }
        .phone-chip i, .phone-chip strong {
            color: #444;
        }
        .whatsapp-chip {
            background: var(--accent1);
            color: #229e59;
            border: 1px solid var(--border2);
        }
        .whatsapp-chip i {
            color: #229e59;
        }
        .facebook-chip {
            background: var(--primary-light);
            color: #1877f3;
            border: 1px solid var(--border1);
        }
        .facebook-chip i {
            color: #1877f3;
        }
        .container-main {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.625rem;
            justify-content: center;
            align-items: stretch;
        }
        .form-section, .result-section {
            flex: 1 1 340px;
            min-width: 340px;
            max-width: 540px;
            background: var(--card);
            border: 1px solid rgba(0,48,135,0.15);
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            min-height: 680px;
        }
        .form-section-title {
            text-align: center;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--primary);
            font-size: 1.15rem;
        }
        #cbslRate {
            margin-bottom: 1rem;
            text-align: center;
        }
        label {
            display: block;
            margin-top: 0.875rem;
            font-weight: 700;
            font-size: 0.98rem;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.375rem;
            border: 1px solid var(--primary);
            border-radius: 0.625rem;
            font-size: 1rem;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-hover);
            box-shadow: 0 0 5px rgba(0,48,135,0.3);
        }
        select {
            appearance: none;
            background: #fff url("data:image/svg+xml;charset=UTF-8,%3Csvg width='14' height='14' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%23003087' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") no-repeat right 0.75rem center/1rem 1rem;
        }
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1.125rem;
        }
        .blue-btn {
            flex: 1 1 180px;
            padding: 0.75rem;
            border: none;
            border-radius: 0.625rem;
            cursor: pointer;
            font-size: 1rem;
            color: #fff;
            background: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: background 0.18s, transform 0.2s;
            font-weight: 700;
            height: 2.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .blue-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }
        .blue-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #downloadBtn {
            display: none;
            flex: 1 1 180px;
            height: 2.75rem;
            margin-top: 1.125rem;
        }
        .result-section-title {
            font-weight: 700;
            margin-bottom: 0.625rem;
            color: var(--primary);
            font-size: 1.12rem;
        }
        #result {
            margin-top: 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
        }
        thead th {
            background: var(--primary);
            color: #fff;
            padding: 0.625rem;
            text-align: left;
            font-weight: 600;
        }
        tbody td {
            padding: 0.5625rem 0.625rem;
            border-bottom: 1px solid rgba(0,48,135,0.15);
        }
        tfoot td {
            padding: 0.625rem;
            font-weight: 700;
            background: #f0f4fa;
        }
        .charts-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.25rem;
        }
        .chart-wrapper {
            width: 100%;
            max-width: 400px;
            margin: 0.5rem 0;
            padding: 0.5rem;
        }
        .chart-title {
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        #pieChart, #taxPieChart {
            display: block;
            margin: 0 auto;
            background: transparent;
            max-width: 100%;
        }
        footer {
            text-align: center;
            width: 100%;
            margin-top: 1.625rem;
            color: #555;
            font-size: 0.92rem;
            padding: 0.875rem 0;
        }
        .faq-section, .info-section, .disclaimer-section, .social-proof, .marketing-banner {
            background: var(--card);
            border: 1px solid rgba(0,48,135,0.15);
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1.25rem;
            text-align: center;
        }
        .marketing-banner {
            padding: 1rem;
            background: var(--banner-blue);
            color: #000;
            font-weight: 700;
            font-size: 1.1rem;
            transition: transform 0.2s;
            border: 2px solid #fff3cd;
            cursor: pointer;
        }
        .marketing-banner:hover {
            transform: translateY(-2px);
        }
        .marketing-banner a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 800;
            transition: color 0.2s;
            display: block;
        }
        .marketing-banner a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }
        .social-proof {
            padding: 0.875rem 1.5rem;
        }
        .faq-section h2, .info-section h2, .disclaimer-section h2, .social-proof h2, .marketing-banner h2 {
            text-align: center;
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 1.125rem;
        }
        .faq-item {
            margin-bottom: 1rem;
            text-align: left;
        }
        .faq-item h3 {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text);
            margin: 0 0 0.5rem;
            cursor: pointer;
            transition: color 0.2s;
            display: inline-flex;
            align-items: center;
            width: 100%;
        }
        .faq-item h3:hover {
            color: var(--primary);
        }
        .faq-item p {
            font-size: 0.95rem;
            color: var(--muted);
            line-height: 1.6;
            display: none;
            margin-left: 1.5rem;
        }
        .faq-item.active p {
            display: block;
        }
        .info-section p, .disclaimer-section p, .social-proof p {
            font-size: 0.95rem;
            color: var(--muted);
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        .info-section h3 {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text);
            margin: 0 0 0.25rem 0;
            text-align: left;
        }
        .info-section ul {
            padding-left: 1.25rem;
            margin-bottom: 1rem;
            text-align: left;
            list-style-type: disc;
            list-style-position: inside;
        }
        .info-section li {
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            text-align: left;
            display: flex;
            flex-direction: column;
        }
        .info-section li p {
            margin-top: 0;
            margin-left: 0;
            text-align: left;
        }
        .info-section a, .result-section a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }
        .info-section a:hover, .result-section a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }
        .disclaimer-section ul {
            list-style: none;
            padding: 0;
            font-size: 0.95rem;
            color: var(--muted);
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        .faq-indicator {
            margin-left: 0.5rem;
            transition: transform 0.3s;
        }
        .faq-item.active .faq-indicator {
            transform: rotate(90deg);
        }
        .result-placeholder {
            font-size: 0.95rem;
            color: var(--muted);
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .result-help {
            font-size: 0.95rem;
            color: var(--muted);
            text-align: center;
        }
        .error-message {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 0.25rem;
            text-align: left;
            background: #ffebee;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        .warning-box {
            background: #ffebee;
            border: 1px solid var(--error);
            color: var(--error);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.625rem;
            font-size: 0.95rem;
            text-align: center;
        }
        .loading {
            text-align: center;
            font-size: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .loading::before {
            content: '';
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--primary);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        @media (max-width: 640px) {
            body {
                padding: 1rem;
                width: 100vw;
                overflow-x: hidden;
            }
            header img {
                max-width: 140px;
            }
            header h1 {
                font-size: clamp(1.5rem, 4.5vw, 1.9rem);
            }
            .form-section, .result-section, .social-proof, .marketing-banner {
                padding: 1rem;
                min-width: 100%;
                max-width: 100%;
                min-height: auto;
                box-sizing: border-box;
            }
            .marketing-banner {
                padding: 0.75rem;
                font-size: 1rem;
            }
            .social-proof {
                padding: 0.75rem 1rem;
            }
            .container-main {
                flex-direction: column;
                gap: 1rem;
                width: 100%;
                align-items: center;
            }
            .contact {
                flex-direction: column;
                gap: 0.5rem;
                margin: 0.5rem 0;
                width: 100%;
            }
            .contact a {
                width: 100%;
                text-align: center;
            }
            .contact .chip {
                width: 100%;
                justify-content: center;
                font-size: 0.95rem;
                padding: 0.625rem;
            }
            .btn-row {
                gap: 0.5rem;
                width: 100%;
            }
            .blue-btn {
                font-size: 0.95rem;
                width: 100%;
            }
            #downloadBtn {
                margin-top: 1rem;
                width: 100%;
            }
            .faq-section, .info-section, .disclaimer-section {
                padding: 1rem;
                width: 100%;
            }
            .faq-section h2, .info-section h2, .disclaimer-section h2, .social-proof h2, .marketing-banner h2 {
                font-size: 1.2rem;
            }
            .faq-item h3, .info-section h3 {
                font-size: 1rem;
            }
            #pieChart, #taxPieChart {
                max-width: 100%;
                width: 100%;
            }
            .result-placeholder, .result-help {
                font-size: 0.9rem;
            }
            .charts-container {
                flex-direction: column;
                width: 100%;
            }
            .chart-wrapper {
                width: 100%;
                max-width: 300px;
                margin: 0.5rem 0;
            }
        }
    </style>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "LocalBusiness",
          "name": "Amarasinghe Prime Enterprises (Pvt) Ltd",
          "image": "https://amarasingheprime.lk/logo.png",
          "url": "https://amarasingheprime.lk/",
          "telephone": "+94 76 944 7740",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "3rd Lane, Malabe",
            "addressLocality": "Malabe",
            "addressRegion": "Western Province",
            "postalCode": "10115",
            "addressCountry": "LK"
          },
          "openingHoursSpecification": [
            {
              "@type": "OpeningHoursSpecification",
              "dayOfWeek": [
                "Monday",
                "Tuesday",
                "Wednesday",
                "Thursday",
                "Friday",
                "Saturday"
              ],
              "opens": "09:00",
              "closes": "17:00"
            }
          ],
          "sameAs": [
            "https://www.facebook.com/share/17Ww1VkV2S/",
            "https://wa.me/message/XSPMWKK4BGVAM1"
          ]
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "How do I calculate the import tax for a vehicle in Sri Lanka?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "The total import tax includes CID, Surcharge, Excise Duty, Luxury Tax, VEL, and VAT, based on CIF value, engine/motor capacity, fuel type, and age. Our calculator uses 2025 Gazette rates for accurate estimates."
              }
            },
            {
              "@type": "Question",
              "name": "What is the CIF Value and why is it important?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "CIF (Cost, Insurance, Freight) is the vehicle's total value upon arrival in Sri Lanka, used as the base for CID and VAT calculations. Accurate CIF values ensure precise tax estimates."
              }
            },
            {
              "@type": "Question",
              "name": "Are hybrid vehicles taxed differently?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes, hybrids (petrol, diesel, plug-in) have different excise duty rates to promote eco-friendly vehicles. Our calculator reflects these rates for accurate tax figures."
              }
            },
            {
              "@type": "Question",
              "name": "How to calculate import duty for electric vehicles?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Electric vehicle duties are based on motor capacity (kW) and age, including CID, VEL, VAT, and others. Use our calculator for precise EV tax estimates."
              }
            },
            {
              "@type": "Question",
              "name": "How to calculate luxury tax for vehicle imports?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Luxury Tax applies when CIF exceeds thresholds: Petrol/Diesel (5M LKR), Hybrid/Plug-in (5.5M LKR), Electric/e-SMART (6M LKR). Rates vary, and our calculator applies them automatically."
              }
            },
            {
              "@type": "Question",
              "name": "What are HS codes and how do they affect taxes?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "HS codes classify vehicles (e.g., Petrol: 8703.2x.xx, Electric: 8703.8x.xx), determining tax rates. Our calculator uses these codes for accurate tax estimates."
              }
            }
          ]
        },
        {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://amarasingheprime.lk/"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Vehicle Tax Calculator",
              "item": "https://amarasingheprime.lk"
            }
          ]
        },
        {
          "@type": "WebPage",
          "name": "Sri Lanka Vehicle Tax Calculator 2025",
          "description": "Calculate vehicle import taxes for Sri Lanka in 2025 with Amarasinghe Prime Enterprises' accurate online tool.",
          "url": "https://amarasingheprime.lk",
          "publisher": {
            "@type": "Organization",
            "name": "Amarasinghe Prime Enterprises (Pvt) Ltd",
            "logo": {
              "@type": "ImageObject",
              "url": "https://amarasingheprime.lk/logo.png"
            }
          },
          "datePublished": "2025-01-01",
          "dateModified": "2025-10-12"
        }
      ]
    }
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KKJ4VY3SP6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KKJ4VY3SP6');
    </script>
</head>
<body>
    <header>
        <img src="/logo.png" alt="Amarasinghe Prime Enterprises Logo" width="160" height="75" loading="lazy">
        <h1>Sri Lanka Vehicle Tax Calculator 2025 - Amarasinghe Prime Enterprises</h1>
        <div class="tagline">Your trusted Japanese automobile partner in Sri Lanka</div>
        <div id="timeDateTime" aria-live="polite"></div>
    </header>
    <div class="contact" id="contact-row">
        <a class="chip phone-chip" href="tel:+94769447740" aria-label="Call Amarasinghe Prime Enterprises at +94 76 944 7740">
            <i class="fas fa-phone" aria-hidden="true"></i> <strong>+94 76 944 7740</strong>
        </a>
        <a class="chip whatsapp-chip" href="https://wa.me/message/XSPMWKK4BGVAM1" target="_blank" rel="noopener" aria-label="Contact via WhatsApp">
            <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
        </a>
        <a class="chip facebook-chip" href="https://www.facebook.com/share/17Ww1VkV2S/" target="_blank" rel="noopener" aria-label="Visit our Facebook page">
            <i class="fab fa-facebook" aria-hidden="true"></i> Facebook
        </a>
    </div>
    <div class="marketing-banner">
        <a href="https://amarasingheprime.lk/who-we-are.html" target="_blank" rel="noopener">Contact us to Personally import your dream vehicle from Japan with absolute reliability</a>
    </div>
    <div class="social-proof">
        <p>⭐ Rated 4.9/5 by 25+ users for accurate Sri Lanka vehicle tax calculations!</p>
    </div>
    <div class="container-main">
        <section class="form-section" aria-labelledby="form-section-title">
            <h2 class="form-section-title" id="form-section-title">Calculate Vehicle Import Taxes for Sri Lanka (2025 Gazette Rates)</h2>
            <form id="taxCalculatorForm" aria-describedby="form-instructions">
                <p id="form-instructions" class="sr-only">Complete all fields to calculate vehicle import taxes based on 2025 Sri Lanka Gazette rates.</p>
                <div id="cbslRate" aria-live="polite">Fetching rate...</div>
                <label for="cifJPY">CIF Value (JPY):</label>
                <input type="number" id="cifJPY" required min="0" step="any" aria-describedby="cifJPY-help">
                <p id="cifJPY-help" class="sr-only">Cost, Insurance, and Freight value in Japanese Yen.</p>
                <label for="exchangeRate">Exchange Rate (JPY/LKR):</label>
                <input type="number" id="exchangeRate" required min="0" step="any" aria-describedby="exchangeRate-help">
                <p id="exchangeRate-help" class="sr-only">Exchange rate from Japanese Yen to Sri Lankan Rupees.</p>
                <label for="vehicleType">Vehicle Type:</label>
                <select id="vehicleType" required aria-describedby="vehicleType-help">
                    <option value="">Select Vehicle Type</option>
                    <option value="petrol">Petrol</option>
                    <option value="diesel">Diesel</option>
                    <option value="petrol_hybrid">Petrol Hybrid</option>
                    <option value="diesel_hybrid">Diesel Hybrid</option>
                    <option value="petrol_plugin">Petrol Plug-in Hybrid</option>
                    <option value="diesel_plugin">Diesel Plug-in Hybrid</option>
                    <option value="electric">Electric</option>
                    <option value="esmart_petrol">e-SMART Hybrid (Petrol Generator)</option>
                    <option value="esmart_diesel">e-SMART Hybrid (Diesel Generator)</option>
                </select>
                <p id="vehicleType-help" class="sr-only">Type of vehicle for tax calculation.</p>
                <label for="capacity" id="capacityLabel">Engine/Motor Capacity (CC or kW):</label>
                <input type="number" id="capacity" required min="0" step="any" aria-describedby="capacity-help">
                <p id="capacity-help" class="sr-only">Engine capacity in CC for fuel vehicles or motor capacity in kW for electric vehicles.</p>
                <label for="age">Vehicle Age:</label>
                <select id="age" required aria-describedby="age-help">
                    <option value="">Select Age</option>
                    <option value="1">Not more than 1 year old</option>
                    <option value="2">More than 1 year but not more than 3 years old</option>
                </select>
                <p id="age-help" class="sr-only">Age of the vehicle for tax rates.</p>
                <label for="dealerFee">Dealer Fee (LKR):</label>
                <input type="number" id="dealerFee" min="0" step="any" value="300000" aria-describedby="dealerFee-help">
                <p id="dealerFee-help" class="sr-only">Dealer fee in Sri Lankan Rupees, if applicable.</p>
                <label for="clearingFee">Clearing Agent Fee (LKR):</label>
                <input type="number" id="clearingFee" min="0" step="any" value="80000" aria-describedby="clearingFee-help">
                <p id="clearingFee-help" class="sr-only">Clearing agent fee in Sri Lankan Rupees, if applicable.</p>
                <div class="btn-row">
                    <button type="button" class="blue-btn" id="calculateBtn">Calculate Tax</button>
                    <button type="button" class="blue-btn" id="resetBtn">Reset</button>
                </div>
            </form>
            <div class="warning-box">
                ⚠️ Warning: Calculations may vary due to regulatory changes imposed by the Sri Lankan government and JPY/LKR exchange rate fluctuations. Contact us on WhatsApp for a detailed quotation.
            </div>
        </section>
        <section class="result-section" aria-labelledby="result-section-title">
            <h2 class="result-section-title" id="result-section-title">Calculation Result</h2>
            <div id="result" aria-live="polite">
                <p class="result-placeholder">Add input data and click the Calculate Tax button to get results</p>
                <p class="result-help">Need help importing your vehicle to Sri Lanka? <a href="https://wa.me/message/XSPMWKK4BGVAM1" target="_blank" rel="noopener">Contact us on WhatsApp</a> for expert assistance!</p>
            </div>
            <div class="btn-row">
                <button id="downloadBtn" class="blue-btn">Save as PDF</button>
            </div>
            <div class="charts-container">
                <div class="chart-wrapper">
                    <h3 class="chart-title">Tax Distribution</h3>
                    <canvas id="taxPieChart" aria-label="Pie chart showing tax breakdown"></canvas>
                    <div id="taxChartSummary" class="sr-only"></div>
                </div>
                <div class="chart-wrapper">
                    <h3 class="chart-title">Total Cost Distribution</h3>
                    <canvas id="pieChart" aria-label="Pie chart showing cost breakdown"></canvas>
                    <div id="pieChartSummary" class="sr-only"></div>
                </div>
            </div>
        </section>
    </div>
    
    <section class="info-section" aria-labelledby="info-section-title">
        <h2 id="info-section-title">Understanding Vehicle Taxes in Sri Lanka</h2>
        <p>Understand the taxes that make up the total vehicle import cost for Sri Lankan importers. Below is a breakdown of the main taxes applied in Sri Lanka. For accurate CIF values, <a href="https://wa.me/message/XSPMWKK4BGVAM1" target="_blank" rel="noopener">contact our team</a> for expert guidance.</p>
        <ul>
            <li>
                <h3>Customs Import Duty (CID)</h3>
                <p>A base tax of 20% of the vehicle's CIF (Cost, Insurance, and Freight) value. See the <a href="http://www.customs.gov.lk/wp-content/uploads/2025/08/Tariff%202022%20Chapter%20-%2087%20Final.pdf" target="_blank" rel="noopener">Sri Lanka Customs Guide</a>.</p>
            </li>
            <li>
                <h3>Surcharge on CID</h3>
                <p>A 50% tax on top of the CID, increasing it to 30% of the CIF value. See the <a href="https://www.treasury.gov.lk/api/file/50324d16-41ec-4512-bd1f-f12e38578425" target="_blank" rel="noopener">Surcharge Gazette</a>.</p>
            </li>
            <li>
                <h3>Excise Duty</h3>
                <p>A major tax based on engine capacity and fuel type, per the latest Excise Duty Gazettes: <a href="https://documents.gov.lk/view/extra-gazettes/2025/1/2418-43_E.pdf" target="_blank" rel="noopener">2418/43</a>, <a href="https://documents.gov.lk/view/extra-gazettes/2025/1/2421-42_E.pdf" target="_blank" rel="noopener">2421/42</a>, <a href="https://documents.gov.lk/view/extra-gazettes/2025/1/2434-04_E.pdf" target="_blank" rel="noopener">2434/04</a>.</p>
            </li>
            <li>
                <h3>Luxury Tax</h3>
                <p>Applied when CIF value exceeds thresholds by fuel type. See the <a href="https://www.treasury.gov.lk/api/file/67450b38-5230-411c-a703-a07a7ef9063c" target="_blank" rel="noopener">Luxury Tax Gazette</a>.</p>
            </li>
            <li>
                <h3>Vehicle Entitlement Levy (VEL)</h3>
                <p>A flat Rs.15,000 for motor cars. See the <a href="https://www.ird.gov.lk/en/publications/Circulars_Circulars/SEC_2016_01_E.pdf" target="_blank" rel="noopener">VEL Circular</a>.</p>
            </li>
            <li>
                <h3>Value Added Tax (VAT)</h3>
                <p>An 18% tax on the sum of CIF and other taxes. See the <a href="http://www.customs.gov.lk/wp-content/uploads/2025/08/Tariff%202022%20Chapter%20-%2087%20Final.pdf" target="_blank" rel="noopener">Customs Duty and VAT Guide</a>.</p>
            </li>
        </ul>
    </section>
    
    <section class="faq-section" aria-labelledby="faq-section-title">
        <h2 id="faq-section-title">Frequently Asked Questions about Sri Lankan Vehicle Import Tax</h2>
        <div class="faq-item">
            <h3 tabindex="0">1. How do I calculate the import tax for a vehicle in Sri Lanka? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>The total import tax includes CID, Surcharge, Excise Duty, Luxury Tax, VEL, and VAT, based on CIF value, engine/motor capacity, fuel type, and age. Our calculator uses 2025 Gazette rates for accurate estimates.</p>
        </div>
        <div class="faq-item">
            <h3 tabindex="0">2. What is the CIF Value and why is it important? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>CIF (Cost, Insurance, Freight) is the vehicle's total value upon arrival in Sri Lanka, used as the base for CID and VAT calculations. Accurate CIF values ensure precise tax estimates.</p>
        </div>
        <div class="faq-item">
            <h3 tabindex="0">3. Are hybrid vehicles taxed differently? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>Yes, hybrids (petrol, diesel, plug-in) have different excise duty rates to promote eco-friendly vehicles. Our calculator reflects these rates for accurate tax figures.</p>
        </div>
        <div class="faq-item">
            <h3 tabindex="0">4. How to calculate import duty for electric vehicles? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>Electric vehicle duties are based on motor capacity (kW) and age, including CID, VEL, VAT, and others. Use our calculator for precise EV tax estimates.</p>
        </div>
        <div class="faq-item">
            <h3 tabindex="0">5. How to calculate luxury tax for vehicle imports? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>Luxury Tax applies when CIF exceeds thresholds: Petrol/Diesel (5M LKR), Hybrid/Plug-in (5.5M LKR), Electric/e-SMART (6M LKR). Rates vary, and our calculator applies them automatically.</p>
        </div>
        <div class="faq-item">
            <h3 tabindex="0">6. What are HS codes and how do they affect taxes? <i class="fas fa-chevron-down faq-indicator"></i></h3>
            <p>HS codes classify vehicles (e.g., Petrol: 8703.2x.xx, Electric: 8703.8x.xx), determining tax rates. Our calculator uses these codes for accurate tax estimates.</p>
        </div>
    </section>
    
    <section class="disclaimer-section" aria-labelledby="disclaimer-section-title">
        <h2 id="disclaimer-section-title">Disclaimer & HS Codes</h2>
        <p>Vehicle taxes in Sri Lanka are based on HS codes, such as petrol (8703.2x.xx), diesel (8703.3x.xx), and electric (8703.8x.xx). Our calculations align with these codes for Sri Lankan importers.</p>
        <p><strong>Important Note:</strong> This calculator is for standard motor cars within the listed HS codes and does not support special-purpose vehicles like hearses or ambulances.</p>
    </section>

    <footer>© 2025 Amarasinghe Prime Enterprises (Pvt) Ltd (PV 00342707)</footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
    <script>
        let resultData = null;
        let fetchedExchangeRate = null;

        function updateDateTime() {
            const el = document.getElementById('timeDateTime');
            el.textContent = `Time: ${new Date().toLocaleString('en-GB', { timeZone: 'Asia/Colombo' })}`;
        }
        setInterval(updateDateTime, 10000);
        updateDateTime();

        async function fetchBOCJPYRate() {
            const rateEl = document.getElementById('cbslRate');
            const exchangeRateInput = document.getElementById('exchangeRate');
            try {
                const response = await fetch('https://amarasingheprime.lk/rate.json');
                if (!response.ok) throw new Error('Failed to fetch rate');
                const { sellingRate, updatedDate } = await response.json();
                fetchedExchangeRate = parseFloat(sellingRate);
                rateEl.innerHTML = `
                    <div style="font-weight:700;color:var(--primary)">Exchange Rate: JPY/LKR = ${fetchedExchangeRate.toFixed(6)}</div>
                    <div style="font-size:0.85em;color:var(--muted)">Source: Central Bank of Sri Lanka (Updated: ${updatedDate})</div>
                `;
                exchangeRateInput.value = fetchedExchangeRate.toFixed(6);
            } catch (error) {
                fetchedExchangeRate = 2.1;
                rateEl.innerHTML = `
                    <div style="font-weight:700;color:var(--primary)">Exchange Rate: JPY/LKR = 2.1</div>
                    <div style="font-size:0.85em;color:var(--error)">Failed to fetch rate. Using fallback rate (2.1). Please verify.</div>
                `;
                exchangeRateInput.value = fetchedExchangeRate.toFixed(6);
            }
            return fetchedExchangeRate;
        }

        function fmt(val, decimals = 2) {
            return Number(val).toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }

        function sanitize(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function calculateTax() {
            const resultDiv = document.getElementById('result');
            const calculateBtn = document.getElementById('calculateBtn');
            calculateBtn.disabled = true;
            resultDiv.innerHTML = '<div class="loading">Calculating taxes...</div>';
            resultDiv.style.opacity = '1';

            setTimeout(() => {
                clearErrors();
                const cifJPY = parseFloat(document.getElementById('cifJPY').value);
                const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || fetchedExchangeRate;
                const type = document.getElementById('vehicleType').value;
                const capacity = parseFloat(document.getElementById('capacity').value);
                const age = document.getElementById('age').value;
                const dealerFee = parseFloat(document.getElementById('dealerFee').value) || 0;
                const clearingFee = parseFloat(document.getElementById('clearingFee').value) || 0;

                if (isNaN(cifJPY) || cifJPY < 0) {
                    showError('cifJPY', 'Please enter a valid, non-negative CIF Value (JPY).');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (isNaN(exchangeRate) || exchangeRate <= 0) {
                    showError('exchangeRate', 'Please enter a valid, positive Exchange Rate (JPY/LKR).');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (!type) {
                    showError('vehicleType', 'Please select a Vehicle Type.');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (isNaN(capacity) || capacity < 0) {
                    showError('capacity', 'Please enter a valid, non-negative Engine/Motor Capacity.');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (!age) {
                    showError('age', 'Please select Vehicle Age.');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (dealerFee < 0) {
                    showError('dealerFee', 'Dealer Fee cannot be negative.');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }
                if (clearingFee < 0) {
                    showError('clearingFee', 'Clearing Agent Fee cannot be negative.');
                    resetResult();
                    calculateBtn.disabled = false;
                    return;
                }

                const cif = cifJPY * exchangeRate;
                const thresholds = {
                    petrol: 5000000, diesel: 5000000, petrol_hybrid: 5500000,
                    diesel_hybrid: 5500000, petrol_plugin: 5500000, diesel_plugin: 5500000,
                    electric: 6000000, esmart_petrol: 6000000, esmart_diesel: 6000000
                };
                const luxuryRates = {
                    petrol: 1.0, diesel: 1.2, petrol_hybrid: 0.8,
                    diesel_hybrid: 0.9, petrol_plugin: 0.8, diesel_plugin: 0.9,
                    electric: 0.6, esmart_petrol: 0.6, esmart_diesel: 0.6
                };

                const threshold = thresholds[type];
                const luxuryRate = luxuryRates[type];

                const cid = cif * 0.2;
                const surcharge = cid * 0.5;
                let excise = 0;

                if (type === 'petrol' || type === 'petrol_hybrid') {
                    if (capacity < 300) excise = 482900;
                    else if (capacity < 1000) excise = Math.max(1992000, capacity * 2450);
                    else if (capacity <= 1300) excise = capacity * 3850;
                    else if (capacity <= 1500) excise = capacity * 4450;
                    else if (capacity <= 1600) excise = capacity * 5150;
                    else if (capacity <= 1800) excise = capacity * 6400;
                    else if (capacity <= 2000) excise = capacity * 7700;
                    else if (capacity <= 2500) excise = capacity * 8450;
                    else if (capacity <= 2750) excise = capacity * 9650;
                    else if (capacity <= 3000) excise = capacity * 10850;
                    else if (capacity <= 4000) excise = capacity * 12050;
                    else excise = capacity * 13300;
                } else if (type === 'diesel' || type === 'diesel_hybrid') {
                    if (capacity < 1500) excise = capacity * 5550;
                    else if (capacity <= 1600) excise = capacity * 6950;
                    else if (capacity <= 1800) excise = capacity * 8300;
                    else if (capacity <= 2000) excise = capacity * 9650;
                    else if (capacity <= 2500) excise = capacity * 9650;
                    else if (capacity <= 2750) excise = capacity * 12050;
                    else if (capacity <= 3000) excise = capacity * 13550;
                    else if (capacity <= 4000) excise = capacity * 12050;
                    else excise = capacity * 13300;
                } else if (type === 'electric' || type === 'petrol_plugin' || type === 'diesel_plugin') {
                    let rate1, rate2;
                    if (capacity <= 50) { rate1 = 18100; rate2 = 36200; }
                    else if (capacity <= 100) { rate1 = 24100; rate2 = 36200; }
                    else if (capacity <= 200) { rate1 = 36200; rate2 = 60400; }
                    else { rate1 = 96600; rate2 = 132800; }
                    excise = age === '1' ? rate1 * capacity : rate2 * capacity;
                } else if (type === 'esmart_petrol') {
                    let rate1, rate2;
                    if (capacity <= 50) { rate1 = 43440; rate2 = 30770; }
                    else if (capacity <= 100) { rate1 = 43440; rate2 = 40970; }
                    else if (capacity <= 200) { rate1 = 63420; rate2 = 41630; }
                    else { rate1 = 139440; rate2 = 111090; }
                    excise = age === '1' ? rate1 * capacity : rate2 * capacity;
                } else if (type === 'esmart_diesel') {
                    let rate1, rate2;
                    if (capacity <= 50) { rate1 = 52130; rate2 = 36920; }
                    else if (capacity <= 100) { rate1 = 52130; rate2 = 49160; }
                    else if (capacity <= 200) { rate1 = 76100; rate2 = 49960; }
                    else { rate1 = 167330; rate2 = 133310; }
                    excise = age === '1' ? rate1 * capacity : rate2 * capacity;
                }

                const luxuryTax = cif > threshold ? (cif - threshold) * luxuryRate : 0;
                const vel = 15000;
                const vatBase = cif + cid + surcharge + excise + luxuryTax + vel;
                const vat = vatBase * 0.18;
                const totalTax = cid + surcharge + excise + luxuryTax + vel + vat;
                const otherCharges = dealerFee + clearingFee;
                const total = cif + totalTax + otherCharges;

                resultData = {
                    cifJPY, exchangeRate, cif, type, 
                    capacity, age, dealerFee, 
                    clearingFee, cid, surcharge, excise, luxuryTax, vel, vat, totalTax, otherCharges, total
                };

                const pct = (val, base) => base > 0 ? ((val / base) * 100).toFixed(2) : '0.00';
                const unit = type.includes('electric') || type.includes('plugin') || type.includes('esmart') ? 'kW' : 'cc';

                const inputsTable = `
                    <div style="font-weight:700;margin-bottom:0.375rem;color:var(--primary)">Inputs</div>
                    <table>
                        <thead><tr><th scope="col">Item</th><th scope="col" style="text-align:right">Value</th></tr></thead>
                        <tbody>
                            <tr><td>CIF (JPY)</td><td style="text-align:right">${fmt(sanitize(cifJPY))}</td></tr>
                            <tr><td>Exchange Rate (JPY→LKR)</td><td style="text-align:right">${fmt(sanitize(exchangeRate), 6)}</td></tr>
                            <tr><td>CIF (LKR)</td><td style="text-align:right">${fmt(sanitize(cif))}</td></tr>
                            <tr><td>Vehicle Type</td><td style="text-align:right">${sanitize(type.replace('_', ' ').toUpperCase())}</td></tr>
                            <tr><td>Engine/Motor Capacity</td><td style="text-align:right">${fmt(sanitize(capacity))} ${unit}</td></tr>
                            <tr><td>Vehicle Age</td><td style="text-align:right">${sanitize(age === '1' ? '≤1 year' : '>1–3 years')}</td></tr>
                            <tr><td>Dealer Fee (LKR)</td><td style="text-align:right">${fmt(sanitize(dealerFee))}</td></tr>
                            <tr><td>Clearing Agent Fee (LKR)</td><td style="text-align:right">${fmt(sanitize(clearingFee))}</td></tr>
                        </tbody>
                    </table>
                `;
                const taxCalculationTable = `
                    <div style="font-weight:700;margin:1.125rem 0 0.375rem;color:var(--primary)">Tax Calculation</div>
                    <table>
                        <thead>
                            <tr>
                                <th scope="col">Tax Type</th>
                                <th scope="col" style="text-align:right">Value (LKR)</th>
                                <th scope="col" style="text-align:right">% of Total Tax</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>CID</td><td style="text-align:right">${fmt(sanitize(cid))}</td><td style="text-align:right">${pct(cid, totalTax)}%</td></tr>
                            <tr><td>Surcharge</td><td style="text-align:right">${fmt(sanitize(surcharge))}</td><td style="text-align:right">${pct(surcharge, totalTax)}%</td></tr>
                            <tr><td>Excise Duty</td><td style="text-align:right">${fmt(sanitize(excise))}</td><td style="text-align:right">${pct(excise, totalTax)}%</td></tr>
                            <tr><td>Luxury Tax</td><td style="text-align:right">${fmt(sanitize(luxuryTax))}</td><td style="text-align:right">${pct(luxuryTax, totalTax)}%</td></tr>
                            <tr><td>VEL</td><td style="text-align:right">${fmt(sanitize(vel))}</td><td style="text-align:right">${pct(vel, totalTax)}%</td></tr>
                            <tr><td>VAT</td><td style="text-align:right">${fmt(sanitize(vat))}</td><td style="text-align:right">${pct(vat, totalTax)}%</td></tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td style="border-top: 2px solid var(--primary); font-weight: bold;">Total Tax & Duties</td>
                                <td style="text-align:right; border-top: 2px solid var(--primary); font-weight: bold;">${fmt(sanitize(totalTax))}</td>
                                <td style="text-align:right; border-top: 2px solid var(--primary); font-weight: bold;">100.00%</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
                const finalSummaryTable = `
                    <div style="font-weight:700;margin:1.125rem 0 0.375rem;color:var(--primary)">Final Summary</div>
                    <table>
                        <thead>
                            <tr>
                                <th scope="col">Item</th>
                                <th scope="col" style="text-align:right">Value (LKR)</th>
                                <th scope="col" style="text-align:right">% of Total Import Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>CIF (LKR)</td><td style="text-align:right">${fmt(sanitize(cif))}</td><td style="text-align:right">${pct(cif, total)}%</td></tr>
                            <tr><td>Total Tax & Duties</td><td style="text-align:right">${fmt(sanitize(totalTax))}</td><td style="text-align:right">${pct(totalTax, total)}%</td></tr>
                            <tr><td>Other Charges (Dealer & Clearing Fees)</td><td style="text-align:right">${fmt(sanitize(otherCharges))}</td><td style="text-align:right">${pct(otherCharges, total)}%</td></tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td style="border-top: 2px solid var(--primary); font-weight: bold;">Total Import Cost</td>
                                <td style="text-align:right; border-top: 2px solid var(--primary); font-weight: bold;">${fmt(sanitize(total))}</td>
                                <td style="text-align:right; border-top: 2px solid var(--primary); font-weight: bold;">100.00%</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
                resultDiv.innerHTML = inputsTable + taxCalculationTable + finalSummaryTable;
                document.getElementById('downloadBtn').style.display = 'block';
                document.getElementById('taxPieChart').style.display = 'block';
                document.getElementById('pieChart').style.display = 'block';

                const taxItems = [
                    { label: 'CID', value: cid },
                    { label: 'Surcharge', value: surcharge },
                    { label: 'Excise Duty', value: excise },
                    { label: 'Luxury Tax', value: luxuryTax },
                    { label: 'VEL', value: vel },
                    { label: 'VAT', value: vat }
                ];
                const costItems = [
                    { label: 'CIF', value: cif },
                    { label: 'Total Tax & Duties', value: totalTax },
                    { label: 'Other Charges (Dealer & Clearing Fees)', value: otherCharges }
                ];

                showPieChart('taxPieChart', taxItems, totalTax, [
                    'var(--primary)', 'var(--primary-hover)', 'var(--primary-light)',
                    '#99ccff', '#cce5ff', '#e6f0ff'
                ], 'taxChartSummary');
                showPieChart('pieChart', costItems, total, [
                    'var(--primary-light)', '#cfe2fa', '#98e4bb'
                ], 'pieChartSummary');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });
                calculateBtn.disabled = false;
            }, 500);
        }

        function resetForm() {
            document.getElementById('taxCalculatorForm').reset();
            document.getElementById('exchangeRate').value = fetchedExchangeRate ? fetchedExchangeRate.toFixed(6) : '2.1';
            document.getElementById('dealerFee').value = '300000';
            document.getElementById('clearingFee').value = '80000';
            document.getElementById('result').innerHTML = `
                <p class="result-placeholder">Add input data and click the Calculate Tax button to get results</p>
                <p class="result-help">Need help importing your vehicle to Sri Lanka? <a href="https://wa.me/message/XSPMWKK4BGVAM1" target="_blank" rel="noopener">Contact us on WhatsApp</a> for expert assistance!</p>
            `;
            document.getElementById('downloadBtn').style.display = 'none';
            document.getElementById('taxPieChart').style.display = 'none';
            document.getElementById('pieChart').style.display = 'none';
            document.getElementById('taxChartSummary').innerHTML = '';
            document.getElementById('pieChartSummary').innerHTML = '';
            if (window.taxPieChartInstance) window.taxPieChartInstance.destroy();
            if (window.pieChartInstance) window.pieChartInstance.destroy();
            resultData = null;
            clearErrors();
            updateCapacityLabel();
        }

        function showError(inputId, message) {
            const input = document.getElementById(inputId);
            let errorDiv = input.nextElementSibling;
            if (!errorDiv || !errorDiv.classList.contains('error-message')) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                input.after(errorDiv);
            }
            errorDiv.textContent = message;
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
        }

        function showPieChart(chartId, items, total, colors, summaryId) {
            const labels = items.map(i => `${i.label} (${pct(i.value, total)}%)`);
            const values = items.map(i => i.value);
            const canvas = document.getElementById(chartId);
            let instanceName = chartId === 'taxPieChart' ? 'taxPieChartInstance' : 'pieChartInstance';
            if (window[instanceName]) window[instanceName].destroy();
            window[instanceName] = new Chart(canvas, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.map(c => c.startsWith('var') ? getComputedStyle(document.documentElement).getPropertyValue(c).trim() : c),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 1.5,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#003087',
                                font: { size: 13, weight: '600' },
                                padding: 20,
                                boxWidth: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    const pct = (ctx.parsed / total * 100).toFixed(2);
                                    return `${ctx.label}: ${fmt(ctx.parsed)} LKR (${pct}%)`;
                                }
                            }
                        }
                    }
                }
            });
            const summary = items.map(i => `${i.label}: ${fmt(i.value)} LKR (${pct(i.value, total)}%)`).join('; ');
            document.getElementById(summaryId).textContent = summary;
        }

        function toggleAnswer(element) {
            const item = element.closest('.faq-item');
            item.classList.toggle('active');
            const indicator = item.querySelector('.faq-indicator');
            indicator.style.transform = item.classList.contains('active') ? 'rotate(90deg)' : 'rotate(0deg)';
        }

        function resetResult() {
            document.getElementById('result').innerHTML = `
                <p class="result-placeholder">Add input data and click the Calculate Tax button to get results</p>
                <p class="result-help">Need help importing your vehicle to Sri Lanka? <a href="https://wa.me/message/XSPMWKK4BGVAM1" target="_blank" rel="noopener">Contact us on WhatsApp</a> for expert assistance!</p>
            `;
        }

        function pct(val, base) {
            return base > 0 ? ((val / base) * 100).toFixed(2) : '0.00';
        }

        function updateCapacityLabel() {
            const vehicleType = document.getElementById('vehicleType').value;
            const capacityLabel = document.getElementById('capacityLabel');
            capacityLabel.textContent = vehicleType.includes('electric') || vehicleType.includes('plugin') || vehicleType.includes('esmart')
                ? 'Motor Capacity (kW):'
                : 'Engine Capacity (CC):';
        }

        function downloadPDF() {
            if (!resultData) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let y = 10;
            doc.setFontSize(16);
            doc.text("Sri Lanka Vehicle Tax Calculation 2025", 10, y);
            y += 7;
            doc.setFontSize(10);
            doc.text("Amarasinghe Prime Enterprises (Pvt) Ltd", 10, y);
            y += 5;
            doc.text("Contact: +94 76 944 7740 | https://amarasingheprime.lk", 10, y);
            y += 7;
            doc.setFontSize(12);
            doc.text(`Date: ${new Date().toLocaleString()}`, 10, y);
            y += 15;
            doc.text("Inputs", 10, y);
            y += 5;
            doc.autoTable({
                startY: y,
                head: [['Item', 'Value']],
                body: [
                    ['CIF (JPY)', fmt(resultData.cifJPY)],
                    ['Exchange Rate (JPY/LKR)', fmt(resultData.exchangeRate, 6)],
                    ['CIF (LKR)', fmt(resultData.cif)],
                    ['Vehicle Type', resultData.type.replace('_', ' ').toUpperCase()],
                    ['Engine/Motor Capacity', `${fmt(resultData.capacity)} ${resultData.type.includes('electric') || resultData.type.includes('plugin') || resultData.type.includes('esmart') ? 'kW' : 'cc'}`],
                    ['Vehicle Age', resultData.age === '1' ? '≤1 year' : '>1–3 years'],
                    ['Dealer Fee (LKR)', fmt(resultData.dealerFee)],
                    ['Clearing Agent Fee (LKR)', fmt(resultData.clearingFee)],
                ],
                theme: 'grid',
                styles: { fontSize: 10 },
            });
            y = doc.lastAutoTable.finalY + 10;
            doc.text("Tax Calculation", 10, y);
            y += 5;
            doc.autoTable({
                startY: y,
                head: [['Tax Type', 'Value (LKR)', '% of Total Tax']],
                body: [
                    ['CID', fmt(resultData.cid), pct(resultData.cid, resultData.totalTax) + '%'],
                    ['Surcharge', fmt(resultData.surcharge), pct(resultData.surcharge, resultData.totalTax) + '%'],
                    ['Excise Duty', fmt(resultData.excise), pct(resultData.excise, resultData.totalTax) + '%'],
                    ['Luxury Tax', fmt(resultData.luxuryTax), pct(resultData.luxuryTax, resultData.totalTax) + '%'],
                    ['VEL', fmt(resultData.vel), pct(resultData.vel, resultData.totalTax) + '%'],
                    ['VAT', fmt(resultData.vat), pct(resultData.vat, resultData.totalTax) + '%'],
                    ['Total Tax & Duties', fmt(resultData.totalTax), '100.00%'],
                ],
                theme: 'grid',
                styles: { fontSize: 10 },
            });
            y = doc.lastAutoTable.finalY + 10;
            doc.text("Final Summary", 10, y);
            y += 5;
            doc.autoTable({
                startY: y,
                head: [['Item', 'Value (LKR)', '% of Total Import Cost']],
                body: [
                    ['CIF (LKR)', fmt(resultData.cif), pct(resultData.cif, resultData.total) + '%'],
                    ['Total Tax & Duties', fmt(resultData.totalTax), pct(resultData.totalTax, resultData.total) + '%'],
                    ['Other Charges', fmt(resultData.otherCharges), pct(resultData.otherCharges, resultData.total) + '%'],
                    ['Total Import Cost', fmt(resultData.total), '100.00%'],
                ],
                theme: 'grid',
                styles: { fontSize: 10 },
            });
            doc.save(`vehicle_tax_calculation_${resultData.type}_${Date.now()}.pdf`);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('calculateBtn').addEventListener('click', calculateTax);
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
            document.querySelectorAll('.faq-item h3').forEach(h3 => {
                h3.addEventListener('click', () => toggleAnswer(h3));
                h3.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleAnswer(h3);
                    }
                });
            });
            document.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('invalid', () => {
                    input.setCustomValidity('Please fill out this field correctly.');
                });
                input.addEventListener('input', () => {
                    input.setCustomValidity('');
                    const errorDiv = input.nextElementSibling;
                    if (errorDiv && errorDiv.classList.contains('error-message')) {
                        errorDiv.remove();
                    }
                });
            });
            document.getElementById('vehicleType').addEventListener('change', updateCapacityLabel);
            fetchBOCJPYRate().then(() => {
                resetForm();
            });
        });
    </script>
</body>
</html>
